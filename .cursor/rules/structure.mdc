---
alwaysApply: true
---
# Code Standards

## File Structure
```
sand-castle-game/
â”œâ”€â”€ index.html                  # Main HTML file
â”œâ”€â”€ tsconfig.json              # TypeScript configuration
â”œâ”€â”€ vite.config.ts             # Vite configuration
â”œâ”€â”€ .eslintrc.json             # ESLint configuration
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                # ğŸ® Pure entry point - game orchestration only
â”‚   â”œâ”€â”€ scenes.ts              # ğŸ­ Scene registry - add new scenes here
â”‚   â”œâ”€â”€ types/                 # TypeScript type definitions
â”‚   â”‚   â”œâ”€â”€ Game.ts           # Game-specific types and interfaces
â”‚   â”‚   â””â”€â”€ Physics.ts        # Physics-related types and constants
â”‚   â”œâ”€â”€ i18n/                  # Internationalization system
â”‚   â”‚   â”œâ”€â”€ index.ts          # Translation system core and management
â”‚   â”‚   â”œâ”€â”€ detect.ts         # Language detection and mapping
â”‚   â”‚   â””â”€â”€ translations/     # Language-specific translation files
â”‚   â”‚       â”œâ”€â”€ en.ts         # English locale settings (minimal)
â”‚   â”‚       â””â”€â”€ ua.ts         # Ukrainian translations (complete)
â”‚   â”œâ”€â”€ scenes/               # Phaser game scenes
â”‚   â”‚   â”œâ”€â”€ BaseScene.ts      # ğŸ—ï¸ Abstract base class - extend for all scenes
â”‚   â”‚   â”œâ”€â”€ MenuScene.ts      # Main menu with navigation
â”‚   â”‚   â”œâ”€â”€ GameScene.ts      # Core gameplay mechanics
â”‚   â”‚   â”œâ”€â”€ GameOverScene.ts  # Game over and victory screens
â”‚   â”‚   â”œâ”€â”€ LevelCompleteScene.ts # Level completion celebration
â”‚   â”‚   â””â”€â”€ SettingsScene.ts  # Settings and language selection
â”‚   â”œâ”€â”€ objects/              # Game object classes
â”‚   â”‚   â”œâ”€â”€ CastlePart.ts     # Castle part physics and rendering
â”‚   â”‚   â””â”€â”€ StabilityManager.ts # Physics stability calculations
â”‚   â”œâ”€â”€ utils/                # Utility functions and helpers
â”‚   â”‚   â”œâ”€â”€ AudioManager.ts   # Audio management with state persistence
â”‚   â”‚   â”œâ”€â”€ PartUtils.ts      # Part spawning and sizing utilities
â”‚   â”‚   â”œâ”€â”€ DeviceUtils.ts    # Device detection and capabilities
â”‚   â”‚   â”œâ”€â”€ TextUtils.ts      # Responsive text creation helpers
â”‚   â”‚   â”œâ”€â”€ ButtonUtils.ts    # Button creation and styling helpers
â”‚   â”‚   â”œâ”€â”€ ConfirmationDialog.ts # Reusable confirmation dialog component
â”‚   â”‚   â”œâ”€â”€ PhaserStateManager.ts # Game state persistence and restoration
â”‚   â”‚   â”œâ”€â”€ SettingsManager.ts # Settings persistence and management
â”‚   â”‚   â”œâ”€â”€ PWAManager.ts     # Progressive web app functionality
â”‚   â”‚   â”œâ”€â”€ SystemInitializer.ts # ğŸš€ System orchestration and initialization
â”‚   â”‚   â”œâ”€â”€ DebugConsole.ts   # ğŸ”§ Development debug functions
â”‚   â”‚   â”œâ”€â”€ MobileEventHandlers.ts # ğŸ“± Mobile-specific event handling
â”‚   â”‚   â””â”€â”€ GameEventHandlers.ts # âš¡ Game event management
â”‚   â””â”€â”€ config/               # Game configuration
â”‚       â”œâ”€â”€ gameConfig.ts     # Game settings, levels, and constants
â”‚       â””â”€â”€ phaserConfig.ts   # âš™ï¸ Phaser.js engine configuration
â”œâ”€â”€ public/                   # Static assets
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ manifest.json         # PWA manifest
â”‚   â””â”€â”€ assets/               # Game assets
â”‚       â”œâ”€â”€ castle-parts.svg  # Castle part graphics
â”‚       â””â”€â”€ sounds/           # Audio files
â””â”€â”€ firebase.json             # Firebase configuration
```

## ğŸ—ï¸ Architecture Overview

### Modular Design Principles
- **Single Responsibility**: Each file has one clear purpose
- **Clean Entry Point**: `main.ts` is just orchestration
- **Separation of Concerns**: Configuration, logic, and utilities are separated
- **Easy Extension**: Adding features doesn't require touching core files

### Key Files and Their Roles

#### **Core Entry Points**
- `src/main.ts` - Game entry point and orchestration only
- `src/scenes.ts` - Scene registry (add new scenes here)

#### **Configuration**
- `src/config/phaserConfig.ts` - Phaser engine settings (resolution, physics, etc.)
- `src/config/gameConfig.ts` - Game-specific settings (levels, gameplay constants)

#### **System Management**
- `src/utils/SystemInitializer.ts` - Orchestrates all system startup
- `src/utils/GameEventHandlers.ts` - Game-wide event handling
- `src/utils/MobileEventHandlers.ts` - Mobile optimizations

#### **Development**
- `src/utils/DebugConsole.ts` - All debug functions for development

## ğŸ¯ How to Extend the Game

### Adding a New Scene
```typescript
// 1. Create your scene class extending BaseScene
export class TutorialScene extends BaseScene {
  constructor() {
    super('TutorialScene');
    this.setBackgroundMusic('menu-theme'); // Optional
  }
  
  protected async customPreload(): Promise<void> { /* ... */ }
  protected customCreate(): void { /* ... */ }
  protected onLanguageChanged(): void { /* ... */ }
}

// 2. Add to src/scenes.ts (ONLY file that needs editing)
import { TutorialScene } from '@/scenes/TutorialScene';

export const SCENES: Record<string, typeof BaseScene> = {
  'MenuScene': MenuScene,
  'GameScene': GameScene,
  'TutorialScene': TutorialScene,  // â† Add this line
  // ... other scenes
};
```

### Modifying Game Configuration
```typescript
// Engine settings: Edit src/config/phaserConfig.ts
export const phaserConfig = {
  width: 800,
  height: 600,
  // ... Phaser settings
};

// Game settings: Edit src/config/gameConfig.ts  
export const GAME_CONFIG = {
  maxLevels: 10,
  scoreMultiplier: 100,
  // ... game constants
};
```

### Adding Debug Functions
```typescript
// Edit src/utils/DebugConsole.ts
export function setupDebugConsole(game: Game): void {
  // Add your debug functions here
  (window as any).myNewDebugFunction = () => {
    console.log('Custom debug function');
  };
}
```

### Adding System Initialization
```typescript
// Edit src/utils/SystemInitializer.ts
private async initializeSystems(): Promise<void> {
  await Promise.all([
    this.initializeAudioSystem(),
    this.initializeMyNewSystem(), // â† Add new system here
    // ... other systems
  ]);
}
```

## Naming Conventions
- **Files**: PascalCase for classes and managers (`CastlePart.ts`, `AudioManager.ts`)
- **Classes**: PascalCase (`class StabilityManager`)
- **Functions**: camelCase (`function calculateStability()`)
- **Constants**: UPPER_SNAKE_CASE (`const MAX_PARTS = 10`)
- **Interfaces**: PascalCase with descriptive names (`interface GameState`)

## TypeScript Standards

```typescript
// Use descriptive names and strong typing
interface CastlePartData {
  id: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  velocity: { x: number; y: number };
  isStable: boolean;
}

// Use const assertions and enums for constants
const PART_TYPES = ['base', 'wall', 'tower', 'decoration'] as const;
type PartType = typeof PART_TYPES[number];

// Prefer function declarations for main functions
function checkStability(parts: CastlePartData[]): StabilityResult {
  // Implementation
}

// Use arrow functions for callbacks and short utilities
const isMoving = (part: CastlePartData) => 
  Math.abs(part.velocity.x) > 0.1 || Math.abs(part.velocity.y) > 0.1;
```

## ğŸ¨ Asset Requirements & Guidelines

### Visual Assets Structure
```
public/assets/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ parts/                 # Castle part sprites
â”‚   â”œâ”€â”€ backgrounds/           # Background images
â”‚   â””â”€â”€ ui/                    # User interface elements
â””â”€â”€ sounds/
    â”œâ”€â”€ effects/               # Sound effects
    â””â”€â”€ music/                 # Background music
```

### Asset Specifications
- **Image Format**: PNG for sprites with transparency, JPG for backgrounds
- **Resolution**: 2x for retina displays, optimized for mobile
- **Color Palette**: Warm beach colors (sandy yellows, ocean blues, sunset oranges)
- **Audio Format**: WAV for effects, MP3 for music
- **File Size**: Individual images <50KB, audio files <100KB, total assets <1.5MB
- **Color Palette**: Warm beach colors (sandy yellows, ocean blues, sunset oranges)
- **Audio Format**: WAV for effects, MP3 for music
- **File Size**: Individual images <50KB, audio files <100KB, total assets <1.5MB