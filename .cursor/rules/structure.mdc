---
alwaysApply: true
---
# Code Standards

## File Structure
```
sand-castle-game/
├── index.html                  # Main HTML file
├── tsconfig.json              # TypeScript configuration
├── vite.config.ts             # Vite configuration
├── .eslintrc.json             # ESLint configuration
├── src/
│   ├── main.ts                # 🎮 Pure entry point - game orchestration only
│   ├── scenes.ts              # 🎭 Scene registry - add new scenes here
│   ├── types/                 # TypeScript type definitions
│   │   ├── Game.ts           # Game-specific types and interfaces
│   │   └── Physics.ts        # Physics-related types and constants
│   ├── i18n/                  # Internationalization system
│   │   ├── index.ts          # Translation system core and management
│   │   ├── detect.ts         # Language detection and mapping
│   │   └── translations/     # Language-specific translation files
│   │       ├── en.ts         # English locale settings (minimal)
│   │       └── ua.ts         # Ukrainian translations (complete)
│   ├── scenes/               # Phaser game scenes
│   │   ├── BaseScene.ts      # 🏗️ Abstract base class - extend for all scenes
│   │   ├── MenuScene.ts      # Main menu with navigation
│   │   ├── GameScene.ts      # Core gameplay mechanics
│   │   ├── GameOverScene.ts  # Game over and victory screens
│   │   ├── LevelCompleteScene.ts # Level completion celebration
│   │   └── SettingsScene.ts  # Settings and language selection
│   ├── objects/              # Game object classes
│   │   ├── CastlePart.ts     # Castle part physics and rendering
│   │   └── StabilityManager.ts # Physics stability calculations
│   ├── utils/                # Utility functions and helpers
│   │   ├── AudioManager.ts   # Audio management with state persistence
│   │   ├── PartUtils.ts      # Part spawning and sizing utilities
│   │   ├── DeviceUtils.ts    # Device detection and capabilities
│   │   ├── TextUtils.ts      # Responsive text creation helpers
│   │   ├── ButtonUtils.ts    # Button creation and styling helpers
│   │   ├── ConfirmationDialog.ts # Reusable confirmation dialog component
│   │   ├── PhaserStateManager.ts # Game state persistence and restoration
│   │   ├── SettingsManager.ts # Settings persistence and management
│   │   ├── PWAManager.ts     # Progressive web app functionality
│   │   ├── SystemInitializer.ts # 🚀 System orchestration and initialization
│   │   ├── DebugConsole.ts   # 🔧 Development debug functions
│   │   ├── MobileEventHandlers.ts # 📱 Mobile-specific event handling
│   │   └── GameEventHandlers.ts # ⚡ Game event management
│   └── config/               # Game configuration
│       ├── gameConfig.ts     # Game settings, levels, and constants
│       └── phaserConfig.ts   # ⚙️ Phaser.js engine configuration
├── public/                   # Static assets
│   ├── favicon.ico
│   ├── manifest.json         # PWA manifest
│   └── assets/               # Game assets
│       ├── castle-parts.svg  # Castle part graphics
│       └── sounds/           # Audio files
└── firebase.json             # Firebase configuration
```

## 🏗️ Architecture Overview

### Modular Design Principles
- **Single Responsibility**: Each file has one clear purpose
- **Clean Entry Point**: `main.ts` is just orchestration
- **Separation of Concerns**: Configuration, logic, and utilities are separated
- **Easy Extension**: Adding features doesn't require touching core files

### Key Files and Their Roles

#### **Core Entry Points**
- `src/main.ts` - Game entry point and orchestration only
- `src/scenes.ts` - Scene registry (add new scenes here)

#### **Configuration**
- `src/config/phaserConfig.ts` - Phaser engine settings (resolution, physics, etc.)
- `src/config/gameConfig.ts` - Game-specific settings (levels, gameplay constants)

#### **System Management**
- `src/utils/SystemInitializer.ts` - Orchestrates all system startup
- `src/utils/GameEventHandlers.ts` - Game-wide event handling
- `src/utils/MobileEventHandlers.ts` - Mobile optimizations

#### **Development**
- `src/utils/DebugConsole.ts` - All debug functions for development

## 🎯 How to Extend the Game

### Adding a New Scene
```typescript
// 1. Create your scene class extending BaseScene
export class TutorialScene extends BaseScene {
  constructor() {
    super('TutorialScene');
    this.setBackgroundMusic('menu-theme'); // Optional
  }
  
  protected async customPreload(): Promise<void> { /* ... */ }
  protected customCreate(): void { /* ... */ }
  protected onLanguageChanged(): void { /* ... */ }
}

// 2. Add to src/scenes.ts (ONLY file that needs editing)
import { TutorialScene } from '@/scenes/TutorialScene';

export const SCENES: Record<string, typeof BaseScene> = {
  'MenuScene': MenuScene,
  'GameScene': GameScene,
  'TutorialScene': TutorialScene,  // ← Add this line
  // ... other scenes
};
```

### Modifying Game Configuration
```typescript
// Engine settings: Edit src/config/phaserConfig.ts
export const phaserConfig = {
  width: 800,
  height: 600,
  // ... Phaser settings
};

// Game settings: Edit src/config/gameConfig.ts  
export const GAME_CONFIG = {
  maxLevels: 10,
  scoreMultiplier: 100,
  // ... game constants
};
```

### Adding Debug Functions
```typescript
// Edit src/utils/DebugConsole.ts
export function setupDebugConsole(game: Game): void {
  // Add your debug functions here
  (window as any).myNewDebugFunction = () => {
    console.log('Custom debug function');
  };
}
```

### Adding System Initialization
```typescript
// Edit src/utils/SystemInitializer.ts
private async initializeSystems(): Promise<void> {
  await Promise.all([
    this.initializeAudioSystem(),
    this.initializeMyNewSystem(), // ← Add new system here
    // ... other systems
  ]);
}
```

## Naming Conventions
- **Files**: PascalCase for classes and managers (`CastlePart.ts`, `AudioManager.ts`)
- **Classes**: PascalCase (`class StabilityManager`)
- **Functions**: camelCase (`function calculateStability()`)
- **Constants**: UPPER_SNAKE_CASE (`const MAX_PARTS = 10`)
- **Interfaces**: PascalCase with descriptive names (`interface GameState`)

## TypeScript Standards

```typescript
// Use descriptive names and strong typing
interface CastlePartData {
  id: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  velocity: { x: number; y: number };
  isStable: boolean;
}

// Use const assertions and enums for constants
const PART_TYPES = ['base', 'wall', 'tower', 'decoration'] as const;
type PartType = typeof PART_TYPES[number];

// Prefer function declarations for main functions
function checkStability(parts: CastlePartData[]): StabilityResult {
  // Implementation
}

// Use arrow functions for callbacks and short utilities
const isMoving = (part: CastlePartData) => 
  Math.abs(part.velocity.x) > 0.1 || Math.abs(part.velocity.y) > 0.1;
```

## 🎨 Asset Requirements & Guidelines

### Visual Assets Structure
```
public/assets/
├── images/
│   ├── parts/                 # Castle part sprites
│   ├── backgrounds/           # Background images
│   └── ui/                    # User interface elements
└── sounds/
    ├── effects/               # Sound effects
    └── music/                 # Background music
```

### Asset Specifications
- **Image Format**: PNG for sprites with transparency, JPG for backgrounds
- **Resolution**: 2x for retina displays, optimized for mobile
- **Color Palette**: Warm beach colors (sandy yellows, ocean blues, sunset oranges)
- **Audio Format**: WAV for effects, MP3 for music
- **File Size**: Individual images <50KB, audio files <100KB, total assets <1.5MB
- **Color Palette**: Warm beach colors (sandy yellows, ocean blues, sunset oranges)
- **Audio Format**: WAV for effects, MP3 for music
- **File Size**: Individual images <50KB, audio files <100KB, total assets <1.5MB